üöÄ Logs Project

‚ú® Vis√£o Geral

Projeto Django desenvolvido para ingest√£o e processamento eficiente de arquivos de log. Ele exp√µe um endpoint dedicado para o upload de arquivos, realizando o processamento das linhas e persist√™ncia dos dados em formato bruto e estruturado.

üí° Funcionalidades Principais

Recurso	Descri√ß√£o
Endpoint de Upload	/logs/upload/ aceita um arquivo de log via requisi√ß√£o POST.
Persist√™ncia Bruta	As linhas do arquivo s√£o anexadas diretamente a raw_logs.txt.
Persist√™ncia Estruturada	As linhas s√£o gravadas no banco de dados (modelo logs.Log) usando bulk_create para alta performance.
Gera√ß√£o de Logs	Scripts auxiliares para simular logs complexos (scripts/generate_complex_log.py) e tr√°fego HTTP (scripts/generate_visits.py).
Automa√ß√£o	Script scripts/upload_files.py para envio automatizado de arquivos de log.

‚öôÔ∏è Pr√©-requisitos

Certifique-se de ter os seguintes componentes instalados:

    Sistema Operacional: Linux (preferencialmente, para monitoramento de logs Nginx)

    Python: Vers√£o 3.10+ (o ambiente de desenvolvimento utiliza Python 3.12)

    Git (Opcional, para clonagem)

    sudo (Para monitorar logs do Nginx, se aplic√°vel)

üìÇ Estrutura do Projeto

Abaixo est√£o os principais arquivos e diret√≥rios:
Caminho	Descri√ß√£o
manage.py	Interface de linha de comando padr√£o do Django.
core/settings.py	Configura√ß√µes gerais do projeto Django.
logs/	Aplica√ß√£o principal do Django (models, views, urls, etc.).
raw_logs.txt	Arquivo onde todos os logs brutos s√£o anexados.
logs/app.log	Logs internos da aplica√ß√£o (configurados via LOGGING).
.env	Vari√°veis de ambiente para configura√ß√£o em tempo de execu√ß√£o.
build.sh	Script para preparar o ambiente (venv, depend√™ncias, migra√ß√µes).
scripts/	Cont√©m scripts auxiliares: upload_files.py, generate_complex_log.py.

Gerar arquivos de teste ‚Äî `scripts/generate_complex_log.py`
- Finalidade: criar arquivos de log grandes e variados para teste de upload e ingest√£o.
- Formato: linhas estilo combined log + campo `uid=UUID`.
- Par√¢metros principais:
  - `--count, -n` ‚Äî n√∫mero de linhas (padr√£o: 100000)
  - `--output, -o` ‚Äî caminho do arquivo de sa√≠da (ex.: `test-files/complex_log.txt`)
  - `--start, -s` ‚Äî timestamp ISO inicial (opcional)
- Exemplo:
```bash
# gera 200k linhas
./venv/bin/python scripts/generate_complex_log.py --count 200000 --output test-files/complex_log.txt

# gera 50k linhas com timestamp inicial
./venv/bin/python scripts/generate_complex_log.py -n 50000 -o test-files/complex_50k.txt -s 2025-10-31T12:00:00
```
- Uso recomendado:
  1. Gerar arquivo em `test-files/`.
  2. Usar `scripts/upload_files.py` (com `DIRECTORIES` apontando para `test-files`) para enviar ao endpoint.
  3. Verificar `raw_logs.txt` e o banco.

  
üõ†Ô∏è Instala√ß√£o e Configura√ß√£o

1. Clonar Reposit√≥rio (Opcional)

Bash

git clone <URL_DO_SEU_REPO>
cd logs

2. Configurar o .env

Crie um arquivo .env na raiz do projeto (/logs/.env) com as seguintes vari√°veis.

    Exemplo M√≠nimo de .env:

Snippet de c√≥digo

# Configura√ß√µes para scripts/upload_files.py
API_URL=http://127.0.0.1:8000/logs/upload/  # Endpoint de upload
DIRECTORIES="/home/mmm/√Årea de trabalho/Projects/logs/test-files" # Caminho para arquivos a serem enviados
AUTH_TOKEN=                                # Token de autentica√ß√£o (se necess√°rio)
SKIP_EXTENSIONS=.tmp,.lock                 # Extens√µes a ignorar
DELAY_SECONDS=0.2                          # Intervalo entre uploads



3. Build do Ambiente

O script build.sh automatiza a cria√ß√£o do ambiente virtual, a instala√ß√£o das depend√™ncias e a aplica√ß√£o das migra√ß√µes.
Bash

# Executar o script build
./build.sh

# Se preferir fazer manualmente:
# cd "/logs"
# python3 -m venv venv
# source venv/bin/activate
# pip install --upgrade pip
# pip install -r requirements.txt
# python manage.py makemigrations
# python manage.py migrate

‚ñ∂Ô∏è Como Executar

1. Iniciar o Servidor Django

Ative o ambiente virtual e inicie o servidor:
Bash

cd <CAMINHO_DO_PROJETO> # Ex: /logs
source venv/bin/activate
python manage.py runserver 127.0.0.1:8000

2. Fluxo Completo de Upload (Resumo)

Este √© o fluxo t√≠pico para testar a ingest√£o de logs:

    Preparar Arquivos: Coloque os arquivos de log que voc√™ deseja testar no diret√≥rio configurado em DIRECTORIES (ex: test-files/). Voc√™ pode usar o scripts/generate_complex_log.py para criar arquivos de teste.

    Executar o Upload:
    Bash

./venv/bin/python scripts/upload_files.py

Verificar: Ap√≥s a execu√ß√£o, confira:

    raw_logs.txt (os logs brutos anexados).

    logs/app.log (logs internos de processamento).

    O banco de dados (para as entradas estruturadas no modelo logs.Log).